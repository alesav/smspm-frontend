---
import type { CountryData } from "../../utils/kv-pricing";

export interface Props {
  country: CountryData;
  lang?: string;
}

const { country, lang: propLang } = Astro.props;
const { pathname } = Astro.url;

// Detect language
const langMatch = pathname.match(/^\/([a-z]{2})(\/|$)/);
const detectedFromPath = langMatch ? langMatch[1] : null;
const lang = (propLang || detectedFromPath || "en") as keyof typeof translations;

const translations = {
  en: {
    badge: "Network Operators",
    title: "Local",
    titleGradient: "Mobile Networks",
    subtitle: "Direct connections with all",
    majorOperators: "major mobile operators",
    in: "in",
    perSms: "per SMS",
    more: "more",
    features: "Features",
    deliveryOptimized: "Delivery optimized for",
  },
  et: {
    badge: "Võrguoperaatorid",
    title: "Kohalikud",
    titleGradient: "Mobiilvõrgud",
    subtitle: "Otsesed ühendused kõigi",
    majorOperators: "peamiste mobiilsideoperaatoritega",
    in: "riigis",
    perSms: "SMS kohta",
    more: "veel",
    features: "Funktsioonid",
    deliveryOptimized: "Kohaletoimetamine optimeeritud",
  },
  ru: {
    badge: "Сетевые операторы",
    title: "Местные",
    titleGradient: "Мобильные сети",
    subtitle: "Прямые соединения со всеми",
    majorOperators: "основными мобильными операторами",
    in: "в",
    perSms: "за SMS",
    more: "ещё",
    features: "Функции",
    deliveryOptimized: "Доставка оптимизирована для",
  },
  es: {
    badge: "Operadores de Red",
    title: "Redes",
    titleGradient: "Móviles Locales",
    subtitle: "Conexiones directas con todos",
    majorOperators: "los principales operadores móviles",
    in: "en",
    perSms: "por SMS",
    more: "más",
    features: "Características",
    deliveryOptimized: "Entrega optimizada para",
  },
  de: {
    badge: "Netzanbieter",
    title: "Lokale",
    titleGradient: "Mobilfunknetze",
    subtitle: "Direkte Verbindungen mit allen",
    majorOperators: "großen Mobilfunkanbietern",
    in: "in",
    perSms: "pro SMS",
    more: "mehr",
    features: "Funktionen",
    deliveryOptimized: "Zustellung optimiert für",
  },
  fr: {
    badge: "Opérateurs Réseau",
    title: "Réseaux",
    titleGradient: "Mobiles Locaux",
    subtitle: "Connexions directes avec tous",
    majorOperators: "les principaux opérateurs mobiles",
    in: "en",
    perSms: "par SMS",
    more: "plus",
    features: "Fonctionnalités",
    deliveryOptimized: "Livraison optimisée pour",
  },
  lv: {
    badge: "Tīkla Operatori",
    title: "Vietējie",
    titleGradient: "Mobilie Tīkli",
    subtitle: "Tiešie savienojumi ar visiem",
    majorOperators: "galvenajiem mobilo sakaru operatoriem",
    in: "valstī",
    perSms: "par SMS",
    more: "vairāk",
    features: "Funkcijas",
    deliveryOptimized: "Piegāde optimizēta",
  },
  lt: {
    badge: "Tinklo Operatoriai",
    title: "Vietiniai",
    titleGradient: "Mobilieji Tinklai",
    subtitle: "Tiesioginiai ryšiai su visais",
    majorOperators: "pagrindiniais mobiliųjų operatoriais",
    in: "šalyje",
    perSms: "už SMS",
    more: "daugiau",
    features: "Funkcijos",
    deliveryOptimized: "Pristatymas optimizuotas",
  },
};

const t = translations[lang] || translations.en;
---

<!-- Mobile Providers Section -->
<section class="mobile-providers py-16 lg:py-24 bg-dynamic-secondary">
  <div class="container mx-auto px-8">
    <div class="text-center mb-16">
      <span
        class="section-badge inline-flex px-6 py-2 bg-cyan/10 border border-cyan/30 rounded-full text-sm text-cyan font-semibold mb-6"
        >{t.badge}</span
      >
      <h2 class="text-3xl lg:text-5xl font-extrabold mb-4 text-dynamic-primary">
        {t.title} <span class="gradient-text">{t.titleGradient}</span>
      </h2>
      <p class="text-lg text-dynamic-secondary max-w-2xl mx-auto">
        {t.subtitle} <span class="gradient-text"
          >{t.majorOperators}</span
        > {t.in} {country.nameLoc || country.namePrep || country.name}
      </p>
    </div>

    <div
      class={`grid gap-8 ${country.providers.length <= 3 ? "grid-cols-1 lg:grid-cols-3" : country.providers.length <= 4 ? "grid-cols-1 md:grid-cols-2 lg:grid-cols-4" : "grid-cols-1 md:grid-cols-2 lg:grid-cols-3"}`}
    >
      {
        country.providers.map((provider) => (
          <div class="provider-card bg-dynamic-primary border border-dynamic-primary rounded-2xl p-8 hover:shadow-xl transition-all duration-300 hover:-translate-y-2">
            <div class="provider-header mb-6">
              <div class="w-16 h-16 bg-gradient-to-br from-cyan/10 to-blue/10 border border-cyan/20 rounded-xl flex items-center justify-center mb-4 mx-auto">
                {provider.logo ? (
                  <img
                    src={provider.logo}
                    alt={`${provider.name} logo`}
                    class="w-full h-full object-contain rounded-lg"
                    loading="lazy"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"
                  />
                ) : null}
                <div
                  class="w-full h-full flex items-center justify-center text-cyan text-xl font-bold"
                  style="display: none;"
                >
                  <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <rect
                      x="4"
                      y="8"
                      width="24"
                      height="16"
                      rx="2"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                    <path
                      d="M8 12H24M8 16H20M8 20H16"
                      stroke="currentColor"
                      stroke-width="1.5"
                      stroke-linecap="round"
                    />
                  </svg>
                </div>
              </div>
              <h3 class="text-xl font-bold text-dynamic-primary text-center mb-2">
                {provider.name}
              </h3>
              <div class="text-center">
                <span class="text-2xl font-bold text-cyan">
                  {country.currency === "EUR"
                    ? "€"
                    : country.currency === "GBP"
                      ? "£"
                      : "$"}
                  {provider.price.toFixed(3)}
                </span>
                <span class="text-dynamic-secondary text-sm ml-1">{t.perSms}</span>
              </div>
            </div>

            <div class="provider-features mb-6">
              <div class="flex flex-wrap gap-2">
                {provider.features.slice(0, 3).map((feature) => (
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-cyan/10 text-cyan border border-cyan/30">
                    {feature}
                  </span>
                ))}
                {provider.features.length > 3 && (
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600 border border-gray-200">
                    +{provider.features.length - 3} {t.more}
                  </span>
                )}
              </div>
            </div>

            <div class="provider-description">
              <p class="text-sm text-dynamic-secondary leading-relaxed">
                {t.deliveryOptimized} {country.nameLoc || country.namePrep || country.name}. {t.features}: {provider.features.join(", ")}.
              </p>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  .gradient-text {
    background: linear-gradient(135deg, #26c6da 0%, #0d47a1 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
</style>
