---
// Navigation Component
const { pathname } = Astro.url;

// Detect language from path, default to 'en'
const langMatch = pathname.match(/^\/([a-z]{2})(\/|$)/);
const lang = (langMatch ? langMatch[1] : "en") as keyof typeof translations;
const isEn = lang === "en";

// Define localized paths
const getLocalizedPath = (path: string) => {
  if (isEn) return path;
  return `/${lang}${path}`;
};

const logoLink = isEn ? "/" : `/${lang}`;
const pricingLink =
  (lang as string) === "et" ? "/et/hinnad" : getLocalizedPath("/countries");
const docsLink = "https://app.smspm.com/docs";
const supportLink = "https://smspm.freshdesk.com/support/tickets/new";

const translations = {
  en: {
    pricing: "Pricing",
    docs: "API Docs",
    support: "Support",
    login: "Login",
    startFree: "Start Free",
  },
  et: {
    pricing: "Hinnad",
    docs: "API-dokumendid",
    support: "Kasutajatugi",
    login: "Logi sisse",
    startFree: "Alusta tasuta",
  },
  ru: {
    pricing: "Ğ¦ĞµĞ½Ñ‹",
    docs: "API Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ",
    support: "ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°",
    login: "Ğ’Ñ…Ğ¾Ğ´",
    startFree: "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾",
  },
  es: {
    pricing: "Precios",
    docs: "Docs API",
    support: "Soporte",
    login: "Iniciar sesiÃ³n",
    startFree: "Empezar gratis",
  },
  de: {
    pricing: "Preise",
    docs: "API-Dokumente",
    support: "Support",
    login: "Anmelden",
    startFree: "Kostenlos starten",
  },
  fr: {
    pricing: "Tarifs",
    docs: "Docs API",
    support: "Support",
    login: "Connexion",
    startFree: "Commencer",
  },
  lv: {
    pricing: "Cenas",
    docs: "API dokumenti",
    support: "Atbalsts",
    login: "Pieteikties",
    startFree: "SÄkt bezmaksas",
  },
  lt: {
    pricing: "Kainos",
    docs: "API dokumentai",
    support: "Pagalba",
    login: "Prisijungti",
    startFree: "PradÄ—ti",
  },
};

const t = translations[lang] || translations.en;
---

<!-- Navigation -->
<nav
  class="navbar fixed top-0 left-0 right-0 z-[1000] transition-all duration-300"
>
  <div class="container mx-auto px-8">
    <div class="nav-content flex items-center justify-between h-[72px]">
      <div class="logo flex items-center">
        <a href={logoLink} class="flex items-center">
          <img
            src="/logo.png"
            alt="SMSPM Logo"
            class="logo-img h-10 w-auto transition-all duration-300"
            width="300"
            height="97"
          />
        </a>
      </div>

      <div class="nav-links hidden md:flex gap-8 items-center">
        <a
          href={pricingLink}
          class="text-dynamic-secondary hover:text-cyan transition-colors duration-150 font-medium text-[15px] relative group"
        >
          {t.pricing}
          <span
            class="absolute bottom-[-4px] left-0 right-0 h-0.5 bg-gradient-1 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300"
          ></span>
        </a>
        <a
          href={docsLink}
          class="text-dynamic-secondary hover:text-cyan transition-colors duration-150 font-medium text-[15px] relative group"
        >
          {t.docs}
          <span
            class="absolute bottom-[-4px] left-0 right-0 h-0.5 bg-gradient-1 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300"
          ></span>
        </a>
        <a
          href={supportLink}
          class="text-dynamic-secondary hover:text-cyan transition-colors duration-150 font-medium text-[15px] relative group"
        >
          {t.support}
          <span
            class="absolute bottom-[-4px] left-0 right-0 h-0.5 bg-gradient-1 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300"
          ></span>
        </a>
      </div>

      <div class="nav-actions flex items-center gap-4">
        <!-- Language Selector -->
        <div class="language-selector relative">
          <button
            class="lang-btn flex items-center gap-2 px-4 py-2 rounded-lg cursor-pointer text-sm font-medium transition-all duration-150"
            id="langBtn"
          >
            <span class="flag text-xl">ğŸŒ</span>
            <span class="lang-text">{lang.toUpperCase()}</span>
            <svg
              class="lang-arrow w-3 h-3 transition-transform duration-150"
              viewBox="0 0 12 12"
              fill="none"
            >
              <path
                d="M2 4L6 8L10 4"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"></path>
            </svg>
          </button>
          <div
            class="lang-dropdown absolute top-[calc(100%+8px)] right-0 min-w-[180px] p-2 rounded-xl shadow-xl opacity-0 invisible transform translate-y-[-8px] transition-all duration-300 z-[1001]"
            id="langDropdown"
          >
            <a
              href="/"
              class="lang-option flex items-center gap-4 px-4 py-2 rounded-lg text-sm transition-all duration-150"
              data-lang="en"
            >
              <span class="flag text-xl">ğŸ‡¬ğŸ‡§</span> English
            </a>
            <a
              href="/et"
              class="lang-option flex items-center gap-4 px-4 py-2 rounded-lg text-sm transition-all duration-150"
              data-lang="et"
            >
              <span class="flag text-xl">ğŸ‡ªğŸ‡ª</span> Eesti
            </a>
            <a
              href="/ru"
              class="lang-option flex items-center gap-4 px-4 py-2 rounded-lg text-sm transition-all duration-150"
              data-lang="ru"
            >
              <span class="flag text-xl">ğŸ‡·ğŸ‡º</span> Ğ ÑƒÑÑĞºĞ¸Ğ¹
            </a>
            <a
              href="/es"
              class="lang-option flex items-center gap-4 px-4 py-2 rounded-lg text-sm transition-all duration-150"
              data-lang="es"
            >
              <span class="flag text-xl">ğŸ‡ªğŸ‡¸</span> EspaÃ±ol
            </a>
            <a
              href="/de"
              class="lang-option flex items-center gap-4 px-4 py-2 rounded-lg text-sm transition-all duration-150"
              data-lang="de"
            >
              <span class="flag text-xl">ğŸ‡©ğŸ‡ª</span> Deutsch
            </a>
            <a
              href="/fr"
              class="lang-option flex items-center gap-4 px-4 py-2 rounded-lg text-sm transition-all duration-150"
              data-lang="fr"
            >
              <span class="flag text-xl">ğŸ‡«ğŸ‡·</span> FranÃ§ais
            </a>
            <a
              href="/lv"
              class="lang-option flex items-center gap-4 px-4 py-2 rounded-lg text-sm transition-all duration-150"
              data-lang="lv"
            >
              <span class="flag text-xl">ğŸ‡±ğŸ‡»</span> LatvieÅ¡u
            </a>
            <a
              href="/lt"
              class="lang-option flex items-center gap-4 px-4 py-2 rounded-lg text-sm transition-all duration-150"
              data-lang="lt"
            >
              <span class="flag text-xl">ğŸ‡±ğŸ‡¹</span> LietuviÅ³
            </a>
          </div>
        </div>

        <!-- Dark Mode Toggle -->
        <button
          class="theme-toggle flex items-center justify-center w-11 h-11 rounded-lg cursor-pointer transition-all duration-300 relative overflow-hidden hover:-translate-y-0.5 hover:shadow-lg"
          id="themeToggle"
          aria-label="Toggle dark mode"
        >
          <svg
            class="sun-icon w-5 h-5 absolute transition-all duration-300"
            viewBox="0 0 24 24"
            fill="none"
          >
            <path
              d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
              stroke="currentColor"
              stroke-width="2"></path>
            <path
              d="M12 2V4M12 20V22M4.92993 4.92993L6.34393 6.34393M17.656 17.656L19.07 19.07M2 12H4M20 12H22M4.92993 19.07L6.34393 17.656M17.656 6.34393L19.07 4.92993"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"></path>
          </svg>
          <svg
            class="moon-icon w-5 h-5 absolute transition-all duration-300 opacity-0 rotate-180"
            viewBox="0 0 24 24"
            fill="none"
          >
            <path
              d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
              stroke="currentColor"
              stroke-width="2"></path>
          </svg>
        </button>

        <a
          href="https://app.smspm.com/app/login"
          class="btn btn-secondary hidden md:inline-flex">{t.login}</a
        >
        <a href="https://app.smspm.com/app/register" class="btn btn-primary"
          >{t.startFree}</a
        >
      </div>

      <!-- Mobile Menu Button -->
      <button
        class="mobile-menu-btn md:hidden flex flex-col gap-1 p-2 rounded-lg transition-all duration-150"
        id="mobileMenuBtn"
      >
        <span class="w-6 h-0.5 transition-all duration-150"></span>
        <span class="w-6 h-0.5 transition-all duration-150"></span>
        <span class="w-6 h-0.5 transition-all duration-150"></span>
      </button>
    </div>
  </div>
</nav>

<style>
  /* Enhance language selector hover */
  .language-selector:hover .lang-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .lang-option:hover {
    background: var(--bg-tertiary);
    color: var(--accent-primary);
  }

  /* Mobile menu animation */
  .mobile-menu-btn.active span:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }

  .mobile-menu-btn.active span:nth-child(2) {
    opacity: 0;
  }

  .mobile-menu-btn.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -6px);
  }
</style>
